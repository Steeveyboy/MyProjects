<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Test - Financial Asset Management</title>
    <link rel="stylesheet" href="css/main.css">
    <style>
        .test-results {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(26, 26, 26, 0.95);
            border: 1px solid #4ecdc4;
            border-radius: 8px;
            padding: 15px;
            max-width: 300px;
            z-index: 10000;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
        .test-item {
            margin: 3px 0;
            color: #e0e0e0;
        }
        .test-success { color: #51cf66; }
        .test-error { color: #ff6b6b; }
        .test-warning { color: #ffd43b; }
    </style>
</head>
<body>
    <div class="test-results" id="testResults">
        <div style="color: #4ecdc4; font-weight: bold; margin-bottom: 10px;">ğŸ§ª Game Test Results</div>
        <div id="testOutput">Loading tests...</div>
    </div>
    
    <!-- Main Game Interface -->
    <div class="game-container">
        <!-- Game Header / HUD -->
        <div class="game-header">
            <div class="game-title">ğŸ“ˆ Asset Manager Pro</div>
            <div class="player-stats">
                <div class="stat-item">
                    <div class="stat-value cash" id="playerCash">$50,000</div>
                    <div class="stat-label">Available Cash</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value portfolio-value" id="portfolioValue">$0</div>
                    <div class="stat-label">Portfolio Value</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value total-return" id="totalReturn">+0.00%</div>
                    <div class="stat-label">Total Return</div>
                </div>
            </div>
            <div class="stat-item">
                <div class="stat-value experience" id="playerLevel">Level 1</div>
                <div class="stat-label">Experience</div>
            </div>
        </div>

        <!-- Market Status Panel -->
        <div class="market-status">
            <div class="market-indicator" id="marketIndicator">
                <span class="indicator-dot bull"></span>
                <span>Market: <span id="marketCondition">Neutral</span></span>
            </div>
            <div class="market-stats">
                <span class="market-stat">10Y Treasury: <span id="tenYearRate">4.25%</span></span>
                <span class="market-stat">Fed Rate: <span id="fedRate">5.00%</span></span>
                <span class="market-stat">VIX: <span id="vixLevel">18.5</span></span>
            </div>
        </div>

        <!-- Main Content Area -->
        <div class="main-content">
            <!-- Asset Store -->
            <div class="panel asset-store">
                <div class="panel-header">
                    <h2>ğŸ’¼ Available Assets</h2>
                    <div class="market-indicators">
                        <span class="indicator yield-curve">Yield Curve: Normal</span>
                    </div>
                </div>
                <div class="asset-list" id="assetList">
                    <!-- Assets will be populated here -->
                </div>
            </div>

            <!-- Portfolio Panel -->
            <div class="panel portfolio">
                <div class="panel-header">
                    <h2>ğŸ“Š Your Portfolio</h2>
                    <div class="portfolio-summary">
                        <span id="portfolioCount">0 assets</span>
                    </div>
                </div>
                <div class="portfolio-content" id="portfolioContent">
                    <div class="empty-portfolio">
                        <p>ğŸ›ï¸ No assets yet. Start with government bonds!</p>
                        <p>Build your portfolio to unlock new asset classes.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Achievements Panel -->
        <div class="panel achievements">
            <div class="panel-header">
                <h2>ğŸ† Achievements</h2>
            </div>
            <div class="achievements-list" id="achievementsList">
                <!-- Achievements will be populated here -->
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Load Scripts -->
    <script src="js/core.js"></script>
    <script src="js/assets.js"></script>
    <script src="js/portfolio.js"></script>
    <script src="js/dashboard.js"></script>

    <script>
        // Test Script
        class GameTester {
            constructor() {
                this.results = [];
                this.testOutput = document.getElementById('testOutput');
            }

            log(message, type = 'info') {
                const className = type === 'success' ? 'test-success' : 
                                type === 'error' ? 'test-error' : 
                                type === 'warning' ? 'test-warning' : '';
                this.results.push({ message, type, className });
                this.updateDisplay();
            }

            updateDisplay() {
                this.testOutput.innerHTML = this.results.map(r => 
                    `<div class="test-item ${r.className}">${r.message}</div>`
                ).join('');
            }

            async runTests() {
                this.log('ğŸš€ Starting game tests...', 'info');

                // Test 1: Check if classes are loaded
                setTimeout(() => {
                    try {
                        if (typeof GameEngine !== 'undefined') {
                            this.log('âœ“ GameEngine class loaded', 'success');
                        } else {
                            this.log('âœ— GameEngine class missing', 'error');
                        }

                        if (typeof TimeSystem !== 'undefined') {
                            this.log('âœ“ TimeSystem class loaded', 'success');
                        } else {
                            this.log('âœ— TimeSystem class missing', 'error');
                        }

                        if (typeof AssetManager !== 'undefined') {
                            this.log('âœ“ AssetManager class loaded', 'success');
                        } else {
                            this.log('âœ— AssetManager class missing', 'error');
                        }

                        if (typeof PortfolioManager !== 'undefined') {
                            this.log('âœ“ PortfolioManager class loaded', 'success');
                        } else {
                            this.log('âœ— PortfolioManager class missing', 'error');
                        }

                        if (typeof Dashboard !== 'undefined') {
                            this.log('âœ“ Dashboard class loaded', 'success');
                        } else {
                            this.log('âœ— Dashboard class missing', 'error');
                        }

                        // Test 2: Try to initialize the game
                        this.testGameInitialization();

                    } catch (error) {
                        this.log(`âœ— Error checking classes: ${error.message}`, 'error');
                    }
                }, 100);
            }

            testGameInitialization() {
                try {
                    // Initialize the game
                    this.log('ğŸ® Initializing game...', 'info');
                    
                    window.gameEngine = new GameEngine();
                    this.log('âœ“ GameEngine initialized', 'success');

                    window.assetManager = new AssetManager();
                    this.log('âœ“ AssetManager initialized', 'success');

                    window.portfolioManager = new PortfolioManager();
                    this.log('âœ“ PortfolioManager initialized', 'success');

                    window.dashboard = new Dashboard();
                    this.log('âœ“ Dashboard initialized', 'success');

                    // Test basic functionality
                    setTimeout(() => {
                        this.testBasicFunctionality();
                    }, 500);

                } catch (error) {
                    this.log(`âœ— Game initialization failed: ${error.message}`, 'error');
                }
            }

            testBasicFunctionality() {
                try {
                    // Test asset creation
                    const assets = window.assetManager.getAvailableAssets();
                    this.log(`âœ“ Found ${assets.length} available assets`, 'success');

                    // Test UI updates
                    window.dashboard.updateUI();
                    this.log('âœ“ UI update successful', 'success');

                    // Test save/load
                    window.gameEngine.saveGame();
                    this.log('âœ“ Save game successful', 'success');

                    // Get player cash
                    const cash = window.gameEngine.gameState.player.cash;
                    this.log(`âœ“ Player has $${cash.toLocaleString()}`, 'success');

                    // Test time system
                    if (window.gameEngine.timeSystem) {
                        const gameDate = window.gameEngine.timeSystem.getGameDate();
                        this.log(`âœ“ Game time: ${gameDate.toDateString()}`, 'success');
                    }

                    this.log('ğŸ‰ All tests passed!', 'success');

                } catch (error) {
                    this.log(`âœ— Functionality test failed: ${error.message}`, 'error');
                }
            }
        }

        // Run tests when page loads
        window.addEventListener('DOMContentLoaded', () => {
            const tester = new GameTester();
            tester.runTests();
        });
    </script>
</body>
</html>
